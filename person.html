<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Person Details</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    background-color: #fafafa;
    color: #222;
  }
  h1 { text-align: center; margin-bottom: 0.2em; }
  .info, .bio {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  img.main-photo { display: block; margin: 20px auto; max-width: 200px; border-radius: 50%; border: 3px solid #ccc; }
  .gallery img { max-width: 150px; margin: 5px; border-radius: 8px; border: 1px solid #ddd; }
</style>
</head>
<body>

<h1 id="name">Loading...</h1>
<img id="main-photo" class="main-photo" src="" alt="Photo">

<div class="info" id="info"></div>

<div class="bio">
  <h2>Biography</h2>
  <div id="bio-text">Loading...</div>
  <div class="gallery" id="bio-images"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const folderId = params.get('id'); // full folder name, e.g., "id16_misha"

  if (!folderId) {
    document.body.innerHTML = "<h2>No person ID specified.</h2>";
    return;
  }

  // Extract numeric ID from folder name
  const personIdMatch = folderId.match(/^id(\d+)/);
  const personId = personIdMatch ? personIdMatch[1] : null;

  if (!personId) {
    document.body.innerHTML = "<h2>Invalid person ID.</h2>";
    return;
  }

  // Load family data
  fetch('data/family_data.json')
    .then(res => res.json())
    .then(allPeople => {
      const person = allPeople.find(p => p.PersonID.toString() === personId);
      if (!person) {
        document.body.innerHTML = `<h2>No person with ID ${personId} found.</h2>`;
        return;
      }

      // Fill header info
      document.getElementById('name').textContent = `${person["Name-ru"] || person.Name} ${person["LastName-ru"] || ""}`;

      // Main photo from images folder
      const mainPhoto = document.getElementById('main-photo');
      if (person.Photo && person.Photo !== "") {
        mainPhoto.src = `images/${person.Photo}`;
      } else {
        mainPhoto.src = "https://placehold.co/200x200?text=No+Photo";
      }

      // Info box
      const infoDiv = document.getElementById('info');
      infoDiv.innerHTML = `
        <p><strong>Birth:</strong> ${person.BirthDate || "—"} (${person.PlaceBirth || "Unknown"})</p>
        <p><strong>Current place:</strong> ${person.PlaceNow || "—"}</p>
        <p><strong>About:</strong> ${person.About || "—"}</p>
        <p><strong>Gender:</strong> ${person.Gender || "—"}</p>
        <p><strong>Father ID:</strong> ${person.FatherID || "—"} | <strong>Mother ID:</strong> ${person.MotherID || "—"}</p>
        <p><strong>Partner(s):</strong> ${person.PartnerID || "—"}</p>
        <p><strong>Children:</strong> ${person.ChildID || "—"}</p>
      `;

      // Load biography text (GitHub-safe)
      const txtPath = `bio/${folderId}/${folderId}.txt`;
      fetch(txtPath)
        .then(resp => resp.ok ? resp.text() : "")
        .then(txt => {
          document.getElementById('bio-text').textContent = txt || "No biography text available.";
        })
        .catch(() => {
          document.getElementById('bio-text').textContent = "No biography text found.";
        });

      // Load additional images from Other_photo field
      const imgDiv = document.getElementById('bio-images');
      const galleryImages = [];

      if (person.Other_photo) {
        const others = person.Other_photo.split(",").map(s => s.trim()).filter(s => s);
        others.forEach(p => galleryImages.push(`bio/${folderId}/${p}`));
      }

      if (galleryImages.length === 0) imgDiv.innerHTML = "<p>No additional images.</p>";
      else imgDiv.innerHTML = galleryImages.map(f => `<img src="${f}" alt="">`).join("");

    })
    .catch(err => {
      console.error("Error loading person data:", err);
      document.body.innerHTML = "<h2>Error loading person data.</h2>";
    });
});
</script>

</body>
</html>
