name: Deploy Static Site to Yandex Object Storage

on:
  push:
    branches:
      - main # The branch that triggers the deployment

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Prepare the credentials using the secrets you created
      - name: Prepare Yandex Credentials
        run: |
          echo "ACCESS_KEY_ID=${{ secrets.YC_ACCESS_KEY_ID }}" >> $GITHUB_ENV
          echo "SECRET_ACCESS_KEY=${{ secrets.YC_SECRET_ACCESS_KEY }}" >> $GITHUB_ENV

      # 2. Upload files to Object Storage using a third-party Action
      - name: Upload files to Object Storage
        uses: yc-actions/yc-obj-storage-upload@v3
        with:
          # Use the credentials from the environment variables
          yc-sa-json-credentials: |
            {
              "accessKeyId": "${{ env.ACCESS_KEY_ID }}",
              "secretAccessKey": "${{ env.SECRET_ACCESS_KEY }}"
            }
          bucket: family-tree-ya # <-- REPLACE THIS
          root: docs/             # Confirmed from your file structure
          clear: true             # Clears the bucket before upload